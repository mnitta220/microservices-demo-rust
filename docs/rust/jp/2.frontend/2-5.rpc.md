# 2-5. gRPC

フロントエンドは、gRPC のクライアントとして、他のサービスが提供する RPC を呼び出します。

## proto ファイル

gRPC の [Protocol Buffers](https://protobuf.dev/) の定義が行われている proto ファイルは、次の場所にあります。

[/src/frontend/protos/demo.proto](/src/frontend/protos/demo.proto)

## proto ファイルのビルド

build.rs には、[tonic-build](https://github.com/hyperium/tonic/tree/master/tonic-build) による proto ファイルからの Rust ソースコードの生成が記述されています。

https://github.com/mnitta220/microservices-demo-rust/blob/c2c3e153c384215ab4cb5f209ef34d40ab108aa6/src/frontend/build.rs#L1-L4

ビルドされた Rust ソースコードは、次の場所に出力されます。

/src/frontend/target/debug/build/frontend-xxxxxxxxxxxxxxxx/out/hipstershop.rs  
（「xxxxxxxxxxxxxxxx」の箇所は不定）  
このファイルは、自動で生成されるので、ソースコード管理する必要はありません。Kubernetes で実行する場合は、[Dockerfile](/src/frontend/Dockerfile) の中で、ビルドを行うように記述されています。

## gRPC クライアントの実装

商品の情報を productcatalog サービスから取得する実装は、次の場所で行われています。

https://github.com/mnitta220/microservices-demo-rust/blob/03e514d216f8a00fc9b7c4710f1f4bb55c05592d/src/frontend/src/rpc/product.rs#L1-L95

26 行目から始まる `get_product_list` 関数は、ホーム画面に表示される商品一覧を取得します。  
27 行目で `get_product_catalog_service_client` を実行して、 `ProductCatalogServiceClient` を取得し、それを使って 31 行目の `list_products` を実行して商品の一覧を取得します。  
40 行目から 56 行目までは、商品の価格をユーザーの通貨に変換しています。
