# 2-3. ページ

## HomePage

`get_home` ハンドラー関数で作成した `HomePage` の実装は、次のようになっています。

https://github.com/mnitta220/microservices-demo-rust/blob/c2c3e153c384215ab4cb5f209ef34d40ab108aa6/src/frontend/src/pages/home_page.rs#L1-L43

6 行目から 9 行目までが `HomePage` 構造体の定義です。`props` と `page` 属性を保持します。

12 行目の `new` 関数で、インスタンスの生成を行います。  
13 行目から 28 行目までで [PageProps](6.page-props.md) の生成を行います。

31 行目で `Page` 構造体のインスタンスを作成します。

34 行目で `HomeBody` 構造体のインスタンスを生成し、35 行目で `page` の `body` にセットします。

## PageProps

`PageProps` 構造体は、各画面やコンポーネントに表示される情報を保持します。  
次のような実装になっています。

https://github.com/mnitta220/microservices-demo-rust/blob/5579da55d8de4778e71d475b5ba10be2868126ef/src/frontend/src/pages/page.rs#L11-L41

`PageProps` の定義は、全画面で１つだけですが、それぞれの画面で、必要となる情報が異なります。`session_id` のように、すべての画面で使われる項目もありますが、画面によって使ったり使わなかったりする項目は `Option` としています。`Option` の項目は、使う項目のみをセットし、使わない項目は `None` にします。たとえば、`HomePage` では、`currency_codes`、`cart`、`hot_products` が必要なので、それらだけをセットします。  
`Component` の `write` メソッドには、`PageProps` への参照が渡されます。

## Page 構造体

画面の出力は、`Page` 構造体の `write` 関数が行います。

https://github.com/mnitta220/microservices-demo-rust/blob/c2c3e153c384215ab4cb5f209ef34d40ab108aa6/src/frontend/src/pages/page.rs#L43-L74

59 行目の `buf` という String に、HTML の出力を行います。

```rust
const PAGE_BUFFER_SIZE: usize = 20_000;
// --snip--
let mut buf = String::with_capacity(PAGE_BUFFER_SIZE);
```

となっているので、20,000 バイトのキャパシティでバッファを確保し、そこに、`buf.push_str(...)` で HTML タグを順次出力していきます。  
`Page` 構造体は、`head` コンポーネントと `body` コンポーネントを持っていて、それぞれの `write` 関数が、&lt;head&gt;タグ、&lt;body&gt;タグを出力します。

## 画面別のコンポーネント構造

各画面のコンポーネントの構造は、以下のようになっています。

- ホーム画面<br>
  [/src/frontend/src/pages/home_page.rs](/src/frontend/src/pages/home_page.rs)<br>
  ![Component structure of homepage](/docs/rust/img/components-home.png)

- プロダクト画面<br>
  [/src/frontend/src/pages/product_page.rs](/src/frontend/src/pages/product_page.rs)<br>
  ![Component structure of product page](/docs/rust/img/components-product.png)

- カート画面<br>
  [/src/frontend/src/pages/cart_page.rs](/src/frontend/src/pages/cart_page.rs)<br>
  ![Component structure of cart page](/docs/rust/img/components-cart.png)

- オーダー画面<br>
  [/src/frontend/src/pages/order_page.rs](/src/frontend/src/pages/order_page.rs)<br>
  ![Component structure of order page](/docs/rust/img/components-order.png)

ホーム画面のコンポーネントにある `model::hot_product::HotProducts` や `rpc::hipstershop::Product` のように、モデルや RPC の構造体でありながら、コンポーネントとしても使用されるものもあります。  
これらの構造体が `Component` トレイトを実装しており、コンポーネントとしても使用できるようにしています。

https://github.com/mnitta220/microservices-demo-rust/blob/c2c3e153c384215ab4cb5f209ef34d40ab108aa6/src/frontend/src/components/body/parts/hot_product.rs#L1-L42

この 3 行目と 11 行目で、それぞれの構造体が `Component` トレイトを実装しており、`write` 関数が定義されています。このため、コンポーネントとして HTML の出力を行うことができます。

<table style="width: 90%; margin-top: 20px;">
<tr>
<td style="text-align: left"><a href="./2-2.handler.md">&lt;&nbsp;2-2. ハンドラー</a></td>
<td></td>
<td style="text-align: right"><a href="./2-4.model.md">2-4. モデル&nbsp;&gt;</a></td>
</tr>
</table>
