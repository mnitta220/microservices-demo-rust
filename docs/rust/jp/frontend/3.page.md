# ページ

## HomePage

get_home ハンドラー関数で作成した HomePage の実装は、次のようになっています。

https://github.com/mnitta220/microservices-demo-rust/blob/7f97100376683550463e8273ac227ebe4492db19/src/frontend/src/pages/home_page.rs#L1-L37

6 行目から 9 行目までが HomePage 構造体の定義です。props と page 属性を保持します。

12 行目の new 関数で、インスタンスの生成を行います。  
13 行目から 22 行目までで [PageProps](6.page-props.md) の生成を行います。

25 行目で Page 構造体のインスタンスを作成します。

28 行目で HomeBody 構造体のインスタンスを生成し、page の body にセットします。

## PageProps

PageProps は、各画面やコンポーネントに表示される情報を保持します。次のような実装になっています。

https://github.com/mnitta220/microservices-demo-rust/blob/7f97100376683550463e8273ac227ebe4492db19/src/frontend/src/pages/page.rs#L12-L42

PageProps の定義は、全画面で１つのみですが、それぞれの画面で、必要となる情報が異なります。session_id のように、すべての画面で使われる必須項目もありますが、画面によって使ったり使わなかったりする項目は Option としています。Option の項目は、使う項目のみをセットし、使わない項目は None にします。たとえば、HomePage では、currency_codes、cart、hot_products が必要なので、それらだけをセットします。

## Page 構造体

画面の出力は、Page 構造体の write 関数が行います。

https://github.com/mnitta220/microservices-demo-rust/blob/7f97100376683550463e8273ac227ebe4492db19/src/frontend/src/pages/page.rs#L44-L79

60 行目の「buf」という String に、HTML の出力を行います。

```rust
const PAGE_BUFFER_SIZE: usize = 20_000;
// --snip--
let mut buf = String::with_capacity(PAGE_BUFFER_SIZE);
```

となっているので、20,000 バイトのキャパシティでバッファを確保し、そこに、buf.push_str(...) で HTML タグを順次出力していきます。  
Page 構造体は、head コンポーネントと body コンポーネントを持っていて、それぞれの write 関数が、&lt;head&gt;、&lt;body&gt;タグを出力します。

## 画面別のコンポーネント構造

各画面のコンポーネントの構造は、以下のようになっています。

- ホーム画面<br>
  [/src/frontend/src/pages/home_page.rs](/src/frontend/src/pages/home_page.rs)<br>
  ![Component structure of homepage](/docs/rust/img/components-home.png)

- プロダクト画面<br>
  [/src/frontend/src/pages/product_page.rs](/src/frontend/src/pages/product_page.rs)<br>
  ![Component structure of product page](/docs/rust/img/components-product.png)

- カート画面<br>
  [/src/frontend/src/pages/cart_page.rs](/src/frontend/src/pages/cart_page.rs)<br>
  ![Component structure of cart page](/docs/rust/img/components-cart.png)

- オーダー画面<br>
  [/src/frontend/src/pages/order_page.rs](/src/frontend/src/pages/order_page.rs)<br>
  ![Component structure of order page](/docs/rust/img/components-order.png)

ホーム画面のコンポーネントにある「model::hot_product::HotProducts」のように、モデルの構造体でありながら、コンポーネントとしても使用されるものもあります。  
これは、モデルの構造体が Component トレイトを実装しており、コンポーネントとしても使用できるためです。

[/src/frontend/src/model/product.rs](/src/frontend/src/components/body/parts/hot_product.rs)

```rust
// HotProducts モデルが Component トレイトを実装している。
impl Component for model::hot_product::HotProducts {
    fn write(&self, props: &PageProps, buf: &mut String) -> Result<()> {
        // --snip--
    }
}

// HotProductItem モデルが Component トレイトを実装している。
impl Component for model::hot_product::HotProductItem {
    fn write(&self, _props: &PageProps, buf: &mut String) -> Result<()> {
        // --snip--
    }
}
```
