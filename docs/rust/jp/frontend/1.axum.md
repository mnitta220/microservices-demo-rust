# axum

画面の表示で使用されるデータを、PageProps 構造体に保持します。Option 属性になっている項目は、その画面で使われる場合のみ、Some(T)がセットされ、使われない場合は None になります。  
Component の write メソッドには、PageProps への参照が渡されます。

https://github.com/mnitta220/microservices-demo-rust/blob/33d28b2f8dc7df0dacfd266abc60ce0c9854da56/src/frontend/src/main.rs#L35-L83

[/src/frontend/src/main.rs](/src/frontend/src/main.rs)

```rust
// --snip--

#[tokio::main]
async fn main() {
    tracing_subscriber::registry()
        .with(
            tracing_subscriber::EnvFilter::try_from_default_env()
                .unwrap_or_else(|_| "frontend=trace".into()),
        )
        .with(tracing_subscriber::fmt::layer())
        .init();

    if let Err(e) = get_environment_values() {
        tracing::error!("failed to get environment values: {:?}", e);
        std::process::exit(0x0100);
    }

    let app = Router::new()
        .route("/", get(handlers::home_handler))
        .route("/product/:id", get(handlers::product_handler))
        .route("/setCurrency", post(handlers::set_currency_handler))
        .route(
            "/cart",
            get(handlers::view_cart_handler).post(handlers::add_to_cart_handler),
        )
        .route("/cart/empty", post(handlers::empty_cart_handler))
        .route("/cart/checkout", post(handlers::place_order_handler))
        .route("/_healthz", get(handlers::health_handler))
        .nest_service("/static", ServeDir::new("static"))
        .layer(
            ServiceBuilder::new()
                .layer(HandleErrorLayer::new(|error: BoxError| async move {
                    if error.is::<tower::timeout::error::Elapsed>() {
                        Ok(StatusCode::REQUEST_TIMEOUT)
                    } else {
                        Err((
                            StatusCode::INTERNAL_SERVER_ERROR,
                            format!("Unhandled internal error: {error}"),
                        ))
                    }
                }))
                .layer(CookieManagerLayer::new())
                .timeout(Duration::from_secs(10))
                .layer(TraceLayer::new_for_http())
                .into_inner(),
        );

    let listener = tokio::net::TcpListener::bind("0.0.0.0:8080").await.unwrap();
    tracing::debug!("listening on {}", listener.local_addr().unwrap());
    axum::serve(listener, app).await.unwrap();
}
```
